---
layout: post
title: 'Enyo Daily #5 - Lists, Repeaters, and Flyweights - Part 2'
date: 2011-07-26 09:32 -0700
---

<p><p><a href="http://blog.technisode.com/post/7913407783/enyo-daily-2-lists-repeaters-and-flyweights-part">Part 1 of this topic</a> covered Flyweights and how they work.  Flyweights themselves are a pretty low level control and not an ideal control with which to develop.  There are a couple other controls one step up the abstraction hierarchy for rendering "lists" of items:  <a href="https://developer.palm.com/content/api/reference/enyo/enyo-api-reference.html#enyo.VirtualRepeater">VirtualRepeater</a> and <a href="https://developer.palm.com/content/api/reference/enyo/enyo-api-reference.html#enyo.Repeater">Repeater</a>.[[MORE]]</p>
<p>In my current project, I needed just such a control.  Specifically, here's the problem I needed to solve:</p>
<blockquote>
<p>Render a configurable number of instances of a control laid out in a horizontal row.</p>
</blockquote>
<p>I tried 3 different approaches:</p>
<ol><li>Programmatic loop using createComponents()</li>
<li>enyo.VirtualRepeater</li>
<li>enyo.Repeater</li>
</ol><p>The first iteration used a simple for loop to create all the components in create() using createComponents().  That was functional but the resulting code was a little tough to manage (mainly due to some unique requirements for some instances of the loop).</p>
<p>Next, I tried using VirtualRepeater.  This was a little better because I only had 1 set of Controls with which to interact but also introduced a new issue:  rendering the items horizontally rather than vertically.  There are actually 2 issues here.  First, VirtualRepeater doesn't appear to support layoutKind.  Second, the components defined as children of the VirtualRepeater are not, in fact, childNodes in the DOM.  Instead, there's an intermediate &lt;div&gt; that groups elements -- the number of which is determined by the value of stripSize.  I was able to work around this using CSS:</p>
<blockquote>
<p>.extras-hflexrepeater, .extras-hflexrepeater &gt; * {<br>    display:-webkit-box;<br>    -webkit-box-orientation:horizontal;<br>    -webkit-box-pack:start;<br>    -webkit-box-align:stretch;<br>}</p>
</blockquote>
<p>The final solution -- and the one I elected to use -- is the Repeater.  The key design difference between the VirtualRepeater and the Repeater is that whereas the VirtualRepeater uses the Flyweight to manage the DOM nodes, the Repeater simply adds more enyo Controls which each manage their own DOM nodes.  In this way, the Repeater is more akin to the programmatic loop.  In fact, that is precisely how it is implemented under the covers.</p>
<p>The choice between the two repeater controls is more about preference in my opinion.  From a development perspective, you have to manage indices in one way or another -- either for the "row" or for the component id.  You gain some efficiency through the auto-selection of rows on event with the Flyweight but that can be mitigated equally well using custom properties on Controls when using the Repeater.</p>
<p>I like to wrap these posts up with a functional code example.  In this case, I've included both a VirtualRepeater and Repeater with the same results to illustrate how they're both used.  Note that the VirtualRepeater code requires the CSS from above.</p>
<blockquote>
<p>var _Example = {<br>    name:"com.technisode.example.App",<br>    kind:"Control",<br>    components:[<br>        {kind:"Scroller", height:"80px", vertical:false, components:[<br>            {kind:"VirtualRepeater", name:"fw", className:"extras-hflexrepeater", onSetupRow:"setupVirtualRepeaterRow", components:[<br>                {width:"120px", components:[<br>                    {kind:"Control", name:"text"},<br>                    {kind:"Button", name:"button", onclick:"buttonClicked"}<br>                ]}<br>            ]}<br>        ]},<br>        {kind:"Scroller", height:"80px", vertical:false, components:[<br>             {kind:"Repeater", name:"repeater", layoutKind:"HFlexLayout", onSetupRow:"setupRepeaterRow"}<br>         ]}<br>    ],<br>    buttonClicked:function() {<br>        // the node is automatically mapped to the right instance on event<br>        // but the enyo-managed data (e.g. this.$.text.getContent()) isn't.<br>        // see enyo.StateManger for a mechanism to save/restore component state<br>        console.log("clicked",this.$.text.node.innerText);<br>    },<br>    setupVirtualRepeaterRow:function(source, index) {<br>        if(index&lt;25) {<br>            this.$.text.setContent("I'm instance "+index);<br>            this.$.button.setCaption("Button #"+index);<br>            <br>            return true;<br>        }<br>    },<br>    setupRepeaterRow:function(source, index) {<br>        if(index&lt;25) {<br>            // note that names have to be unique because, unlike VirtualRepeater,<br>            // each of these enyo.Controls will exist as children of Repeater <br>            return {width:"120px", components:[<br>                {kind:"Control", content:"I'm instance "+index, name:"text"+index},<br>                {kind:"Button", name:"button"+index, caption:"Button #"+index, onclick:"buttonClicked"}<br>            ]}<br>        }<br>    }<br>};<br><br>enyo.kind(_Example);</p>
</blockquote></p>