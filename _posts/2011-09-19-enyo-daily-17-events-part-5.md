---
layout: post
title: 'Enyo Daily #17 - Events - Part 5'
date: 2011-09-19 21:00 -0700
---

<p><p>I wouldn't have expected to write so much about events in enyo but there's a lot of depth to cover.  I previously posted about an <a href="http://blog.technisode.com/post/8545758113/enyo-daily-11-animated-grid-layout">Animated Grid Layout</a> control I created which I later used in <a href="http://developer.palm.com/appredirect/?packageid=com.tiqtech.scorekeeper">Score Keeper</a> for the board selection.  I have a similar requirement for the main panes of <a href="http://developer.palm.com/appredirect/?packageid=com.tiqtech.incontact">InContact </a>but also need to reorder the items.[[MORE]]</p>
<p>To enable the reordering, I wanted to defer the event handling to the new grid control rather than binding them in my app.  This keeps that logic contained to a separate control (one I could swap out for an alternate grid control if desired) and not muddling up my main app code.  The rub with this is that is was difficult to add an event handler to an enyo instance when you're not the owner of the control (in my scenario, the main app is the owner whereas the grid is just the container.  More on ownership and containment in <a href="http://blog.technisode.com/post/7941076324/enyo-daily-3-ownership">Enyo Daily 3</a>).</p>
<p>The rather simple solution I discovered was to add an instance function to the enyo instance during creation.  The function is bound (using enyo.bind) to the grid control so it can enable reordering.</p>
<p>One caution with this approach is that it will by default prevent calling a handler declared for the onX event for the instance.  You could call dispatchIndirectly yourself in your instance method but I'll leave that as homework.  :)</p>
<p>Here's a quick example.  I'll share the reorderable grid control once it's actually complete!</p>
<blockquote>
<p>var _Example = {<br>    name:"com.technisode.example.App",<br>    kind:"Control",<br>    components:[<br>        {kind:"ApplicationEvents", name:"appEvents", onUnload:"logAppEvent"},<br>        {kind:"EventSender", name:"eventSender", onSend:"sent"},<br>        {kind:"Button", onclick:"clicked"},<br>        {kind:"ContainerListener", components:[<br>            {kind:"Button", caption:"Clicking me will be handled by my container"}<br>        ]},<br>        {kind:"Input", onkeypress:"press"},<br>        {kind:"Dashboard", name:"db"}<br>    ],<br>    create:function() {<br>        this.inherited(arguments);<br>        <br>        this.$.db.setLayers([{title:"My Dashboard", text:"important message"}]);<br>        <br>        // map all ApplicationEvents to logAppEvent<br>        var ae = this.$.appEvents;<br>        Object.keys(enyo.ApplicationEvents.prototype.events).forEach(function(key) {<br>            //enyo.log("setting handler for ",key);<br>            ae[key] = "logAppEvent";<br>        });<br>        <br>        enyo.dispatcher.rootHandler.addListener(this);<br>    },<br>    logAppEvent:function(source, e) {<br>        enyo.log("logAppEvent",e.type);<br>    },<br>    resizeHandler:function() {<br>        enyo.log("dimensions",window.document.body.offsetWidth,window.document.body.offsetHeight);<br>    },<br>    captureDomEvent:function(e) {<br>        enyo.log("A DOM event occured", e.type);<br>        <br>        // returning true would indicated the event is captured and prevent the bubble phase<br>        // thereby preventing the declared handlers (clicked in this case) from being called<br>        <br>        // returning false (or no explicit return) lets things continue<br>        return false;<br>    },<br>    dispatchDomEvent:function(e) {<br>        // like any other method, you could override dispatchDomEvent and implement custom routing<br>        e.myCustomField = "This is a custom field";<br>        <br>        return this.inherited(arguments);<br>    },<br>    press:function(source, event) {<br>        enyo.log(source, event);<br>    },<br>    clickHandler:function(source, event) {<br>        enyo.log("bubbled up to me", event.myCustomField);<br>        <br>        // calling event.stopPropagation() or returning true will end the bubble phase<br>    },<br>    clicked:function(source, event) {<br>        // trigger my custom events<br>        this.$.eventSender.go();<br>        <br>        // toggles event handler between send and secondSent ... just because ...<br>        this.$.eventSender.onSend = (this.$.eventSender.onSend === "sent") ? "secondSent" : "sent";<br>        <br>        // calling event.stopPropagation() or returning true will end the bubble phase<br>    },<br>    sent:function(source, one, two, three) {<br>        enyo.log("sent", one, two, three)<br>    },<br>    handleOnAlert:function(source, obj) {<br>        enyo.log("alerted", enyo.json.stringify(obj));<br>    },<br>    secondSent:function(source, one, two, three) {<br>        enyo.log("secondSent handles onSend now", one, two, three)<br>    },<br>    customGlobalEventHandler:function(sender, param) {<br>        enyo.log("customGlobalEvent", param.data);<br>    }<br>}<br><br>var _ContainerListener = {<br>    name:"ContainerListener",<br>    kind:"Control",<br>    createComponent:function() {<br>        var o = this.inherited(arguments);<br>        o.clickHandler = enyo.bind(this, "childClicked");<br>        return o;<br>    },<br>    childClicked:function(source, event) {<br>        enyo.log("one of my child nodes was clicked!")<br>    }<br>}<br><br>var _EventSender = {<br>    name:"EventSender",<br>    kind:"Component",<br>    events:{ <br>        onSend:"handleOnSend",<br>        onAlert:{value:"handleOnAlert", caller:"sendAlert"}<br>    },<br>    create:function() {<br>        this.inherited(arguments);<br>        <br>        enyo.dispatcher.rootHandler.addListener(this);<br>    },<br>    go:function() {<br>        this.doSend(1,2,3);    // dispatchIndirectly<br>        this.sendAlert({a:1, b:2});<br>        window.enyo.dispatch({type:"customGlobalEvent", data:"something to pass"});<br>    },<br>    customGlobalEventHandler:function(sender, e) {<br>        enyo.log("also caught customGlobalEvent");<br>    }<br>}<br><br>enyo.kind(_ContainerListener);<br>enyo.kind(_EventSender);<br>enyo.kind(_Example);</p>
</blockquote></p>